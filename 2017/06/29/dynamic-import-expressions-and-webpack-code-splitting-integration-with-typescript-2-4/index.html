<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width"><title>Dynamic Import Expressions and webpack 2 Code Splitting integration with TypeScript 2.4 | José Quinto</title><meta name="description" content="Dynamic Import Expressions and webpack 2 Code Splitting integration with TypeScript 2.4"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><meta property="og:image" content="https://blog.josequinto.com/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/featured.png"><meta name="twitter:image" content="https://blog.josequinto.com/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/featured.png"><meta property="fb:app_id" content="155567495101835"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="https://blog.josequinto.com/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/" property="og:url"><meta name="twitter:title" content="Dynamic Import Expressions and webpack 2 Code Splitting integration with TypeScript 2.4 | José Quinto" property="og:title"><meta name="twitter:site" content="@jquintozamora"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.josequinto.com/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/"><meta property="og:title" content="Dynamic Import Expressions and webpack 2 Code Splitting integration with TypeScript 2.4 | José Quinto"><link rel="canonical" href="https://blog.josequinto.com/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/"><link rel="author" href="https://plus.google.com/u/0/108403117712061507579"><link rel="alternate" type="application/rss+xml" title="Jose Quinto" href="https://blog.josequinto.com/feed.rss"><meta name="theme-color" content="#ffffff"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.1"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js" defer></script><script>var GLOBAL = { 
  root: '/',
  algolia: {"appId":"C7MOFESP3V","apiKey":"cdc4a9b7af864c710f2d3da5caf59eec","indexName":"dev_JQBLOG","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><div id="bodyWrapper"><div id="content-outer"><div id="top-container" style="background-image: url(/background.svg)"><div id="page-header"><span class="pull-left"> <a class="brand" href="/"><img class="brand-image" src="/jose-quinto.png"><div class="brand-name">José Quinto</div></a></span><i class="fa fa-share toggle-social" aria-hidden="true"></i><div class="socialicons" id="header-social-icons"><a class="social-icon" href="https://twitter.com/jquintozamora" target="_blank" rel="noopener"><i class="fa fa-twitter"></i></a><a class="social-icon" href="https://github.com/jquintozamora" target="_blank" rel="noopener"><i class="fa fa-github"></i></a><a class="social-icon" href="https://codepen.io/jquintozamora" target="_blank" rel="noopener"><i class="fa fa-codepen"></i></a><a class="social-icon" href="https://www.linkedin.com/in/jquintozamora" target="_blank" rel="noopener"><i class="fa fa-linkedin"></i></a><a class="social-icon" href="https://stackoverflow.com/users/5015774/jos%C3%A9-quinto-zamora?tab=profile" target="_blank" rel="noopener"><i class="fa fa-stack-overflow"></i></a><a class="social-icon" href="https://blog.josequinto.com/feed.rss" target="_blank" rel="noopener"><i class="fa fa-rss"></i></a></div><a class="social-icon search"><i class="fa fa-search"></i></a><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Search posts:</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/about.html">About</a></span></div><div id="post-info"><div id="post-title">Dynamic Import Expressions and webpack 2 Code Splitting integration with TypeScript 2.4</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-06-29</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/taxonomy/New-Feature-Info/">New-Feature-Info</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/taxonomy/New-Feature-Info/Github-Project/">Github-Project</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/"></span></a></div></div></div><div class="layout" id="content-inner"><section class="articlePostContainer"><nav class="sidebar-toc"><div class="sidebar-toc__title">Contents</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Overview"><span class="toc-number">1.</span> <span class="toc-text">Overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unexpected-configuration-for-Code-Splitting-with-webpack"><span class="toc-number">2.</span> <span class="toc-text">Unexpected configuration for Code Splitting with webpack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Expected-TypeScript-configuration-for-Code-Splitting-with-webpack"><span class="toc-number">3.</span> <span class="toc-text">Expected TypeScript configuration for Code Splitting with webpack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conclusions"><span class="toc-number">4.</span> <span class="toc-text">Conclusions</span></a></li></ol></div></nav><section class="postArticle"><article id="post"><div class="post-featuredImage"><img src="featured.png" width="auto" height="auto"></div><div id="post-content"><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>Two days ago (27/06/2017), was released <a href="https://github.com/Microsoft/TypeScript/wiki/What%27s-new-in-TypeScript#typescript-24" target="_blank" rel="noopener">TypeScript 2.4.0</a>. Really good news to see that now dynamic import expressions are supported!.</p>
<blockquote>
<p><strong>Dynamic import expressions</strong> are a new feature and part of <strong>ECMAScript</strong> that allows users to asynchronously request a module at any arbitrary point in your program.
<strong>TC39</strong> JavaScript committee has it’s own proposal which is in stage 3, and it’s called <a href="https://github.com/tc39/proposal-dynamic-import" target="_blank" rel="noopener">import() proposal for JavaScript</a>.</p>
</blockquote>
<p>From other side, webpack bundler has a feature called Code Splitting – Async:</p>
<blockquote>
<p><strong>Code Splitting – Async</strong> allows you to split your bundle into chunks which can be downloaded asynchronously at a later time. For instance, this allows to serve a minimal bootstrap bundle first and to asynchronously load additional features later.</p>
</blockquote>
<p>At first glance, I did a <strong>strict relationship between</strong> these two features. I mean, it’s <strong>natural</strong> to <strong>think</strong> (if we are using <strong>webpack</strong> in our dev <strong>workflow</strong>) that by using<strong> TypeScript 2.4 dynamic import expressions, </strong>will automatically <strong>produce bundle chunks</strong> and automatically <strong>code-split you JS final bundle</strong>. BUT, that is not as easy as it seems, because it <strong>depends</strong> <strong>on</strong> the <strong>tsconfig.json</strong> configuration we are working with.</p>
<p>The thing is that <a href="https://webpack.js.org/guides/code-splitting" target="_blank" rel="noopener">webpack code splitting</a> supports two similar techniques to achieve this goal: using import() (preferred, ECMAScript proposal) and require.ensure() (legacy, webpack specific). And what that means is the expected TypeScript output is leave the import() statement as it is instead of transpile it to anything else.</p>
<p>Let’s see and example to figure out how to configure <strong>webpack + TypeScript 2.4</strong>.</p>
<p>In the following code I want to lazy load the library moment but I am interested on code splitting as well, which means, having moment library in a <strong>separate chunk of JS (javascript file)</strong> and that will be loaded only when required.</p>
<script src="https://gist.github.com/jquintozamora/fcffb0df5d0400da6a0191424bf36b37.js"></script>


<h2 id="Unexpected-configuration-for-Code-Splitting-with-webpack"><a href="#Unexpected-configuration-for-Code-Splitting-with-webpack" class="headerlink" title="Unexpected configuration for Code Splitting with webpack"></a>Unexpected configuration for Code Splitting with webpack</h2><script src="https://gist.github.com/jquintozamora/4ac5f6791239b3810719a5af61265fc8.js"></script>

<p>Output:</p>
<script src="https://gist.github.com/jquintozamora/b1f267f26f970d4d1938ad246e9349dc.js"></script>


<p>Note how the<strong> JS output from TypeScript 2.4.0 is resolving directly with a Promise.resolve() instead of using import().</strong> Then, even if that solution will <strong>work in terms of functionality</strong>, but <strong>not in terms of code splitting</strong>, because that is NOT the input expected by webpack.</p>
<h2 id="Expected-TypeScript-configuration-for-Code-Splitting-with-webpack"><a href="#Expected-TypeScript-configuration-for-Code-Splitting-with-webpack" class="headerlink" title="Expected TypeScript configuration for Code Splitting with webpack"></a>Expected TypeScript configuration for Code Splitting with webpack</h2><script src="https://gist.github.com/jquintozamora/492a563dfe35eb4cb0f8f206755fd39b.js"></script>

<p>Output:</p>
<script src="https://gist.github.com/jquintozamora/8a292b74aabd2f8d4a2212b5e469eb43.js"></script>

<blockquote>
<p>However, <strong>this output is the ideal for webpack Code Splitting</strong>, and we don’t have to worry about the other “normal” imports which are transpiled using esnext, because <strong>webpack knows how to handle all of them (imports and exports).</strong></p>
</blockquote>
<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h2><ul>
<li><p><strong>Using “module”: “esnext”</strong> TypeScript produces the mimic impot() statement to be input for<strong> Webpack Code Splitting.</strong></p>
</li>
<li><p>Currently (TypeScript 2.4.0) There is a <strong>bug</strong> using “<strong>module”: “esnext</strong>”. Some external libraries like moment are not recognized by TypeScript if you don’t configure explicitly <strong>“moduleResolution” : “node”.</strong> <strong>PLEASE, DON’T FORGET TO INCLUDE IT IN YOUR TSCONFIG.JSON.</strong></p>
</li>
<li><p>You can see a working sample here: <a href="https://github.com/jquintozamora/react-typescript-webpack2-cssModules-postCSS/blob/master/app/src/components/AsyncLoading/AsyncLoading.tsx#L57-L68" title="https://github.com/jquintozamora/react-typescript-webpack2-cssModules-postCSS/blob/master/app/src/components/AsyncLoading/AsyncLoading.tsx#L57-L68" target="_blank" rel="noopener">TypeScript 2.4, Dynamic Import Expressions with webpack Code Splitting Sample</a>.</p>
</li>
</ul>
<p>Some TypeScript forums for reference:</p>
<ul>
<li><p><a href="https://github.com/Microsoft/TypeScript/pull/14774" title="https://github.com/Microsoft/TypeScript/pull/14774" target="_blank" rel="noopener">[Master] wip-dynamic import</a></p>
</li>
<li><p><a href="https://github.com/Microsoft/TypeScript/issues/14495" title="https://github.com/Microsoft/TypeScript/issues/14495" target="_blank" rel="noopener">[Design Spec] ESNext import()</a></p>
</li>
</ul>
</div><div id="post-content-bottom-space"><p>&nbsp;</p></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://twitter.com/jquintozamora" target="_blank">José Quinto</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.josequinto.com/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/">https://blog.josequinto.com/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/category/webpack/">webpack</a><a class="post-meta__tags" href="/category/TypeScript/">TypeScript</a><a class="post-meta__tags" href="/category/Code-Splitting/">Code Splitting</a></div></article><nav id="pagination"><div class="prev-post pull-left"><a href="/2017/07/10/how-to-configure-webpack-for-replacing-your-api-module-path-with-a-mock-api/" title="previous page"><i class="fa fa-chevron-left" aria-hidden="true"></i><span>How to configure webpack for replacing your API module path by a Mock API Path</span></a></div><div class="next-post pull-right"><a href="/2017/06/28/how-to-consume-our-decorators-models-and-parsers-from-spfx-the-winning-combination/" title="next page"><span>Part 5. How to consume our decorators, models and parsers from SPFx, the winning combination</span><i class="fa fa-chevron-right" aria-hidden="true"></i></a></div></nav><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = 'https://blog.josequinto.com/2017/06/29/dynamic-import-expressions-and-webpack-code-splitting-integration-with-typescript-2-4/';
  this.page.identifier = '1084';
  this.page.title = 'Dynamic Import Expressions and webpack 2 Code Splitting integration with TypeScript 2.4';
}
var d = document, s = d.createElement('script');
s.src = "https://https-blog-josequinto-com.disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-src" src="//https-blog-josequinto-com.disqus.com/count.js" async></script></section></section></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By José Quinto</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i></div><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.1"></script><script src="/js/fancybox.js?version=1.5.1"></script><script src="/js/copy.js?version=1.5.1"></script><script src="/js/scroll.js?version=1.5.1"></script><script src="/js/head.js?version=1.5.1"></script><script src="/js/search/algolia.js"></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-44570510-1', 'auto');
ga('send', 'pageview');</script><script async src="https://www.google-analytics.com/analytics.js"></script><link rel="manifest" href="/manifest.json"><script async src="/js/registerServiceWorker.js"></script></body></html>