<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width"><title>Enable Azure Invocation Log at Web Job function Level for PnP Provisioning | José Quinto</title><meta name="description" content="Enable Azure Invocation Log at Web Job function Level for PnP Provisioning"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover"><meta property="og:image" content="https://blog.josequinto.com/2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/featured.jpg"><meta name="twitter:image" content="https://blog.josequinto.com/2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/featured.jpg"><meta property="fb:app_id" content="155567495101835"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="https://blog.josequinto.com/2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/" property="og:url"><meta name="twitter:title" content="Enable Azure Invocation Log at Web Job function Level for PnP Provisioning | José Quinto" property="og:title"><meta name="twitter:site" content="@jquintozamora"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.josequinto.com/2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/"><meta property="og:title" content="Enable Azure Invocation Log at Web Job function Level for PnP Provisioning | José Quinto"><link rel="canonical" href="https://blog.josequinto.com/2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/"><link rel="author" href="https://plus.google.com/u/0/108403117712061507579"><link rel="alternate" type="application/rss+xml" title="Jose Quinto" href="https://blog.josequinto.com/feed.rss"><meta name="theme-color" content="#ffffff"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.1"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.3/dist/instantsearch.min.js" defer></script><script>var GLOBAL = { 
  root: '/',
  algolia: {"appId":"C7MOFESP3V","apiKey":"cdc4a9b7af864c710f2d3da5caf59eec","indexName":"dev_JQBLOG","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script></head><body><div id="bodyWrapper"><div id="content-outer"><div id="top-container" style="background-image: url(/background.svg)"><div id="page-header"><span class="pull-left"> <a class="brand" href="/"><img class="brand-image" src="/jose-quinto.png"><div class="brand-name">José Quinto</div></a></span><i class="fa fa-share toggle-social" aria-hidden="true"></i><div class="socialicons" id="header-social-icons"><a class="social-icon" href="https://twitter.com/jquintozamora" target="_blank" rel="noopener"><i class="fa fa-twitter"></i></a><a class="social-icon" href="https://github.com/jquintozamora" target="_blank" rel="noopener"><i class="fa fa-github"></i></a><a class="social-icon" href="https://codepen.io/jquintozamora" target="_blank" rel="noopener"><i class="fa fa-codepen"></i></a><a class="social-icon" href="https://www.linkedin.com/in/jquintozamora" target="_blank" rel="noopener"><i class="fa fa-linkedin"></i></a><a class="social-icon" href="https://stackoverflow.com/users/5015774/jos%C3%A9-quinto-zamora?tab=profile" target="_blank" rel="noopener"><i class="fa fa-stack-overflow"></i></a><a class="social-icon" href="https://blog.josequinto.com/feed.rss" target="_blank" rel="noopener"><i class="fa fa-rss"></i></a></div><a class="social-icon search"><i class="fa fa-search"></i></a><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Search posts:</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/about.html">About</a></span></div><div id="post-info"><div id="post-title">Enable Azure Invocation Log at Web Job function Level for PnP Provisioning</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2017-02-16</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/taxonomy/How-To/">How-To</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/taxonomy/How-To/Click-Trough/">Click-Trough</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/"></span></a></div></div></div><div class="layout" id="content-inner"><section class="articlePostContainer"><nav class="sidebar-toc"><div class="sidebar-toc__title">Contents</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configure-Logs"><span class="toc-number">2.</span> <span class="toc-text">Configure Logs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#First-Step-Configure-app-config-web-config"><span class="toc-number">2.1.</span> <span class="toc-text">First Step. Configure app.config / web.config</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Second-Step-Link-TextWriter-log-with-Trace"><span class="toc-number">2.2.</span> <span class="toc-text">Second Step. Link TextWriter log with Trace</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Results"><span class="toc-number">3.</span> <span class="toc-text">Results</span></a></li></ol></div></nav><section class="postArticle"><article id="post"><div class="post-featuredImage"><img src="featured.jpg" width="auto" height="auto"></div><div id="post-content"><h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Few months ago I posted about <a href="/2016/08/02/enable-log-and-trace-information-for-pnp-core-provisioning-when-using-console-application/">enabling log and trace information for PnP Core Provisioning when using Console Application</a>. </p>
<p>Recently, I have been working in several projects with PnP Partner Pack Provisioning and some custom <strong>Web Jobs</strong> using PnP Core Provisioning bits as well. And there is one annoying thing in common, <strong>not having PnP Provisioning Logs!!</strong> So, sometimes we are blind and we don’t exactly know what is going on with the Site Creation.</p>
<p>This post is about Enable PnP Provisioning Invocation or Function Logs when using your custom Web Job or using PnP Partner Pack.</p>
<p>When I mention Invocation / Function Logs that is what I mean:</p>
<p><a href="./image.png"><img src="./image.png" alt="image" title="image"></a></p>
<p><strong>Note: In order to enable these logs, you should configure AzureWebJobsDashboard setting in the Azure Web App settings. IMPORTANT, it need to be in the UI, is not valid to have it on web.config only.</strong></p>
<p><a href="./image-1.png"><img src="./image-1.png" alt="image" title="image"></a></p>
<p>In my opinion it is important enable logs at this level because:</p>
<ul>
<li><p><strong>Invocation-Scoped Log</strong>. Every Site Creation will have its own log.</p>
</li>
<li><p><strong>One URI per log </strong>as well in the format: https://<webapp>,azurewebsites.net/azurejobs/api/logs/output/<invocationguid> </invocationguid></webapp></p>
</li>
</ul>
<h2 id="Configure-Logs"><a href="#Configure-Logs" class="headerlink" title="Configure Logs"></a>Configure Logs</h2><p>Let’s see how to configure it.</p>
<h3 id="First-Step-Configure-app-config-web-config"><a href="#First-Step-Configure-app-config-web-config" class="headerlink" title="First Step. Configure app.config / web.config"></a>First Step. Configure app.config / web.config</h3><script src="https://gist.github.com/jquintozamora/9d084182708814a78435e79ec1f7077c.js"></script> 

<p>&nbsp;</p>
<h3 id="Second-Step-Link-TextWriter-log-with-Trace"><a href="#Second-Step-Link-TextWriter-log-with-Trace" class="headerlink" title="Second Step. Link TextWriter log with Trace"></a>Second Step. Link TextWriter log with Trace</h3><p>Create a new custom <code>TextWriterTraceListener</code> using <code>TextWriter</code> log (<code>ProcessQueueMessage</code> one) and connect it to Trace listener previously configured. </p>
<p>I highly recommends to add the custom <code>TraceFilter</code> as well because a side effect of enable all Trace events is that we will be receiving tons of TokenCache and AcquireTokenHandlerBase Information logs and these will be annoying. In fact, it will be difficult to find the PnP logs among these ones:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OfficeDevPnP.PartnerPack.ContinousJob.exe Information: 0 : 02/16/2017 14:50:11: ab5a77a1-c3d7-4211-9f8b-22d3915163ae - AcquireTokenHandlerBase: === Token Acquisition finished successfully. An access token was retuned:</span><br><span class="line"> Access Token Hash: sdsdfsdffdgsfgsfgsd=</span><br><span class="line"> Refresh Token Hash: [No Refresh Token]</span><br><span class="line"> Expiration Time: 02/16/2017 15:48:46 +00:00</span><br><span class="line"> User Hash: null</span><br><span class="line">OfficeDevPnP.PartnerPack.ContinousJob.exe Information: 0 : 02/16/2017 16:10:11: 9f72b853-367c-41a8-ac9a-d38a7a3f861c - TokenCache: An item matching the requested resource was found in the cache”</span><br></pre></td></tr></table></figure>
<p>So, in the below code you can see how to create custom <code>RemoveWordsFilter</code> and how to use it in the <code>TextWriterTraceListener</code> object.</p>
<script src="https://gist.github.com/jquintozamora/e2e4c145905af47698efdfc296af511e.js"></script> 

<p>&nbsp;</p>
<h2 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h2><p>These are the results:</p>
<p><a href="./image-2.png"><img src="./image-2.png" alt="image" title="image"></a></p>
</div><div id="post-content-bottom-space"><p>&nbsp;</p></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="https://twitter.com/jquintozamora" target="_blank">José Quinto</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://blog.josequinto.com/2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/">https://blog.josequinto.com/2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/category/Azure/">Azure</a><a class="post-meta__tags" href="/category/PnP/">PnP</a><a class="post-meta__tags" href="/category/log/">log</a></div></article><nav id="pagination"><div class="prev-post pull-left"><a href="/2017/03/03/upload-json-object-as-a-file-into-office-365-using-javascript-jsom/" title="previous page"><i class="fa fa-chevron-left" aria-hidden="true"></i><span>Upload JSON Object as a File into Office 365 using JavaScript (JSOM)</span></a></div><div class="next-post pull-right"><a href="/2017/01/20/getting-react-to-load-polyfills-only-when-needed/" title="next page"><span>Getting React to Load polyfills only when needed</span><i class="fa fa-chevron-right" aria-hidden="true"></i></a></div></nav><div id="disqus_thread"></div><script>var disqus_config = function () {
  this.page.url = 'https://blog.josequinto.com/2017/02/16/enable-azure-invocation-log-at-a-web-job-function-level-for-pnp-provisioning/';
  this.page.identifier = '886';
  this.page.title = 'Enable Azure Invocation Log at Web Job function Level for PnP Provisioning';
}
var d = document, s = d.createElement('script');
s.src = "https://https-blog-josequinto-com.disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-src" src="//https-blog-josequinto-com.disqus.com/count.js" async></script></section></section></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2022 By José Quinto</div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i></div><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.1"></script><script src="/js/fancybox.js?version=1.5.1"></script><script src="/js/copy.js?version=1.5.1"></script><script src="/js/scroll.js?version=1.5.1"></script><script src="/js/head.js?version=1.5.1"></script><script src="/js/search/algolia.js"></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-44570510-1', 'auto');
ga('send', 'pageview');</script><script async src="https://www.google-analytics.com/analytics.js"></script><link rel="manifest" href="/manifest.json"><script async src="/js/registerServiceWorker.js"></script></body></html>